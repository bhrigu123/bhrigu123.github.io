<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>LRU Cache - C++ Implementation - Bhrigu Srivastava</title>
  <meta name="author" content="Bhrigu Srivastava">

  <meta name="description" content="LRU (Least Recently Used) algorithm implementation and explanation in C++"> 
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://bhrigu.me/blog/2017/01/22/lru-cache-c-plus-plus-implementation/">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="Bhrigu Srivastava" type="application/atom+xml">

  <!-- http://opengraphprotocol.org/ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://bhrigu.me/blog/2017/01/22/lru-cache-c-plus-plus-implementation/">
  <meta property="og:title" content="LRU Cache - C++ Implementation - Bhrigu Srivastava">
  <meta property="og:description" content="LRU (Least Recently Used) algorithm implementation and explanation in C++">

  <script src="/javascripts/libs/jquery/jquery-2.1.3.min.js"></script>

<link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<!-- Hotjar Tracking Code for http://bhrigu123.github.io -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:291872,hjsv:5};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'//static.hotjar.com/c/hotjar-','.js?sv=');
</script>


  
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">

  
   <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-64358360-1', 'auto');
    ga('send', 'pageview');

  </script>


</head>

  <body   >
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="wrap">
      
        <header role="banner">
          <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" title="toggle navbar" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Bhrigu Srivastava</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                
<li ><a href="/about">About</a></li>
<li ><a href="/blog/archives">Archives</a></li>


            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="navbar-form navbar-right" action="https://www.google.com/search" method="GET">
                    <input type="hidden" name="sitesearch" value="bhrigu.me">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


        </header>
      
      <div id="main" role="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content" itemscope itemtype="http://schema.org/Blog">
    <meta itemprop="name" content="Bhrigu Srivastava" />
    <meta itemprop="description" content="Personal website of Bhrigu Srivastava. My blog posts, projects, resume, about me and other pages." />
    <meta itemprop="url" content="http://bhrigu.me" />
    <article class="hentry" role="article" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
      
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












  

<span class="glyphicon glyphicon-calendar"></span> <time datetime="2017-01-22T23:50:26+05:30"  data-updated="true" itemprop="datePublished dateCreated">Sun 22 Jan 2017, 11:50 PM</time>
        
      </p>
    
    
    <h1 class="entry-title" itemprop="name headline">
        LRU Cache - C++ Implementation
        
    </h1>
    
  </header>


<div class="entry-content clearfix" itemprop="articleBody description"><p>LRU, or <em>Least Recetly Used</em>, is one of the <a href="https://en.wikipedia.org/wiki/Page_replacement_algorithm">Page Replacement Algorithms</a>, in which the system manages a given amount of memory - by making decisions what pages to keep in memory, and which ones to remove when the memory is full.  <!-- more --></p>

<p>Let&rsquo;s say, the capacity of a given cache (memory) is <em>C</em>.</p>

<p>Our memory stores key, value pairs in it.</p>

<p>It should support the following operations:</p>

<ul>
<li><p><code>get(key)</code> -  Get the value of the given key if it exists in the memory (else, let&rsquo;s say -1)</p></li>
<li><p><code>put(key, value)</code> - Set, or insert the value if not present. If our cache reaches its capacity, we should remove the item which was least recently used.</p></li>
</ul>


<p>Another constraint to the given problem is:<br>
Both the operations must be done in constant <a href="https://en.wikipedia.org/wiki/Time_complexity">Time Complexity</a>, ie in <em>O(1)</em>.</p>

<p>Now, we need to think of some of the data structures, which would allow us to perform the above operations in <em>O(1)</em>.</p>

<h3>Choice of data structures</h3>

<ul>
<li><p><strong>Queue</strong> - We should maintain a Queue (double ended queue), in which the most recently used pages (items) are in the front, and the least recently used pages are in the rear. This would allow to remove the least recently used item in <em>O(1)</em> time.</p></li>
<li><p><strong>Doubly Linked List</strong> - We should implement our Queue using a doubly linked list (instead of arrays), which would allow us to apply <em>shifting</em> operations in <em>O(1)</em> time. (like, when we need to shift a page to the front of the queue)</p></li>
<li><p><strong>HashMap</strong> - We should hash the key values to the location where the page is stored. This would allow <code>get</code> operation in <em>O(1)</em> time.</p></li>
</ul>


<h3>Design and Implementation</h3>

<p>Now that we know which what all data structures to use, let&rsquo;s look at the implementation.</p>

<p>Whenever a user <code>gets</code> a page, we return its value, and also move that page to the front of our Queue.</p>

<p>Whenever a user <code>sets</code> a page, if the page is already present, we update its value and move that page to the front of our Queue, <br>
else we add a new page to our cache in the front of the Queue.<br>
But if our cache has reached its capacity, we remove the least recently used page (ie the rear item in our Queue) from our memory.</p>

<ol>
    <li>
        <code>class Node</code>
        <ul>
            <li>
                Data members:
                <ol>
                    <li>key</li>
                    <li>value</li>
                    <li>next node address</li>
                    <li>previous node address</li>
                </ol>
            </li>
        </ul>
    </li><br>

    <li>
        <code>class DoublyLinkedList</code>
        <ul>
            <li>
                Data members:
                <ol>
                    <li>front node address</li>
                    <li>rear node address</li>
                </ol>
            </li>

            <li>
                Member functions:
                <ol>
                    <li>move_page_to_head(..)</li>
                    <li>remove_rear_page()</li>
                    <li>get_rear_page()</li>
                    <li>add_page_to_head(..)</li>
                </ol>
            </li>

        </ul>
    </li><br>

    <li>
        <code>class LRU</code>
        <ul>
            <li>
                Data members:
                <ol>
                    <li>capacity</li>
                    <li>current size</li>
                    <li>a DoublyLinkedList object</li>
                    <li>Hashmap</li>
                </ol>
            </li>

            <li>
                Member functions:
                <ol>
                    <li>get(key)</li>
                    <li>put(key, value)</li>
                </ol>
            </li>

        </ul>
    </li>

</ol>


<p>Let&rsquo;s make the 3 classes.</p>

<h3>Code</h3>

<figure class='code'><figcaption><span>LRU Cache cpp (LRUCache.cpp)</span> <a href='/downloads/code/LRUCache.cpp'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &lt;iostream&gt;</span>
</span><span class='line'><span class="cp">#include &lt;map&gt;</span>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Node</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">public</span><span class="o">:</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">;</span>
</span><span class='line'>  <span class="n">Node</span> <span class="o">*</span><span class="n">prev</span><span class="p">,</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
</span><span class='line'>  <span class="n">Node</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span><span class="o">:</span> <span class="n">key</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">value</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">prev</span><span class="p">(</span><span class="nb">NULL</span><span class="p">),</span> <span class="n">next</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span> <span class="p">{}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">DoublyLinkedList</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">Node</span> <span class="o">*</span><span class="n">front</span><span class="p">,</span> <span class="o">*</span><span class="n">rear</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="kt">bool</span> <span class="nf">isEmpty</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">rear</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span><span class="o">:</span>
</span><span class='line'>  <span class="n">DoublyLinkedList</span><span class="p">()</span><span class="o">:</span> <span class="n">front</span><span class="p">(</span><span class="nb">NULL</span><span class="p">),</span> <span class="n">rear</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span> <span class="p">{}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">Node</span><span class="o">*</span> <span class="n">add_page_to_head</span><span class="p">(</span><span class="kt">int</span> <span class="n">key</span><span class="p">,</span> <span class="kt">int</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">Node</span> <span class="o">*</span><span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">front</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">rear</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">front</span> <span class="o">=</span> <span class="n">rear</span> <span class="o">=</span> <span class="n">page</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">page</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">front</span><span class="p">;</span>
</span><span class='line'>          <span class="n">front</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">page</span><span class="p">;</span>
</span><span class='line'>          <span class="n">front</span> <span class="o">=</span> <span class="n">page</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">page</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">void</span> <span class="n">move_page_to_head</span><span class="p">(</span><span class="n">Node</span> <span class="o">*</span><span class="n">page</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">page</span><span class="o">==</span><span class="n">front</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">page</span> <span class="o">==</span> <span class="n">rear</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">rear</span> <span class="o">=</span> <span class="n">rear</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">;</span>
</span><span class='line'>          <span class="n">rear</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">page</span><span class="o">-&gt;</span><span class="n">prev</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">page</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span><span class='line'>          <span class="n">page</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">page</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">page</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">front</span><span class="p">;</span>
</span><span class='line'>      <span class="n">page</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>      <span class="n">front</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">page</span><span class="p">;</span>
</span><span class='line'>      <span class="n">front</span> <span class="o">=</span> <span class="n">page</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">void</span> <span class="n">remove_rear_page</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">isEmpty</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">front</span> <span class="o">==</span> <span class="n">rear</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">delete</span> <span class="n">rear</span><span class="p">;</span>
</span><span class='line'>          <span class="n">front</span> <span class="o">=</span> <span class="n">rear</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">Node</span> <span class="o">*</span><span class="n">temp</span> <span class="o">=</span> <span class="n">rear</span><span class="p">;</span>
</span><span class='line'>          <span class="n">rear</span> <span class="o">=</span> <span class="n">rear</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">;</span>
</span><span class='line'>          <span class="n">rear</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>          <span class="k">delete</span> <span class="n">temp</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">Node</span><span class="o">*</span> <span class="n">get_rear_page</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">rear</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">LRUCache</span><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">size</span><span class="p">;</span>
</span><span class='line'>  <span class="n">DoublyLinkedList</span> <span class="o">*</span><span class="n">pageList</span><span class="p">;</span>
</span><span class='line'>  <span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">Node</span><span class="o">*&gt;</span> <span class="n">pageMap</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span><span class="o">:</span>
</span><span class='line'>    <span class="n">LRUCache</span><span class="p">(</span><span class="kt">int</span> <span class="n">capacity</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="o">-&gt;</span><span class="n">capacity</span> <span class="o">=</span> <span class="n">capacity</span><span class="p">;</span>
</span><span class='line'>      <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="n">pageList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DoublyLinkedList</span><span class="p">();</span>
</span><span class='line'>        <span class="n">pageMap</span> <span class="o">=</span> <span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">Node</span><span class="o">*&gt;</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">int</span> <span class="n">get</span><span class="p">(</span><span class="kt">int</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">pageMap</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">==</span><span class="n">pageMap</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="n">pageMap</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// move the page to front</span>
</span><span class='line'>        <span class="n">pageList</span><span class="o">-&gt;</span><span class="n">move_page_to_head</span><span class="p">(</span><span class="n">pageMap</span><span class="p">[</span><span class="n">key</span><span class="p">]);</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">val</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">void</span> <span class="n">put</span><span class="p">(</span><span class="kt">int</span> <span class="n">key</span><span class="p">,</span> <span class="kt">int</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">pageMap</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">!=</span><span class="n">pageMap</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// if key already present, update value and move page to head</span>
</span><span class='line'>          <span class="n">pageMap</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
</span><span class='line'>          <span class="n">pageList</span><span class="o">-&gt;</span><span class="n">move_page_to_head</span><span class="p">(</span><span class="n">pageMap</span><span class="p">[</span><span class="n">key</span><span class="p">]);</span>
</span><span class='line'>          <span class="k">return</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">size</span> <span class="o">==</span> <span class="n">capacity</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// remove rear page</span>
</span><span class='line'>          <span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="n">pageList</span><span class="o">-&gt;</span><span class="n">get_rear_page</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">;</span>
</span><span class='line'>          <span class="n">pageMap</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
</span><span class='line'>          <span class="n">pageList</span><span class="o">-&gt;</span><span class="n">remove_rear_page</span><span class="p">();</span>
</span><span class='line'>          <span class="n">size</span><span class="o">--</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// add new page to head to Queue</span>
</span><span class='line'>        <span class="n">Node</span> <span class="o">*</span><span class="n">page</span> <span class="o">=</span> <span class="n">pageList</span><span class="o">-&gt;</span><span class="n">add_page_to_head</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
</span><span class='line'>        <span class="n">size</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>        <span class="n">pageMap</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">~</span><span class="n">LRUCache</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">Node</span><span class="o">*&gt;::</span><span class="n">iterator</span> <span class="n">i1</span><span class="p">;</span>
</span><span class='line'>      <span class="k">for</span><span class="p">(</span><span class="n">i1</span><span class="o">=</span><span class="n">pageMap</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="n">i1</span><span class="o">!=</span><span class="n">pageMap</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="n">i1</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">delete</span> <span class="n">i1</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">delete</span> <span class="n">pageList</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Running the code</h3>

<p>Save the above code in a file, say of name <code>LRUCache.cpp</code>.</p>

<p>In the same directory create another <code>.cpp</code> file in which we will use get() and put() functions of our LRU. Paste the code below, compile &amp; run it:</p>

<figure class='code'><figcaption><span>RunLRUCache.cpp</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &lt;iostream&gt;</span>
</span><span class='line'><span class="cp">#include &quot;LRUCache.cpp&quot;</span>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">LRUCache</span> <span class="n">cache</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>  <span class="c1">// cache capacity 2</span>
</span><span class='line'>  <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">cache</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">cache</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>  <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">cache</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">cache</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>  <span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">cache</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">cache</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p><strong><u>Output:</u></strong></p>

<figure class='code'><figcaption><span>output</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>2
</span><span class='line'>-1
</span><span class='line'>5
</span><span class='line'>2
</span><span class='line'>-1
</span><span class='line'>8
</span></code></pre></td></tr></table></div></figure>


<p>The output comes out to be correct (you can check by creating a cache of size 2, and executing the given <code>get</code> and <code>put</code> functions in the above order.)</p>

<p>That is all for LRU Cache implementation - ie, the &ldquo;Least Recently Used Page replacement algorithm&rdquo;.</p>

<p><code>Notes:</code></p>

<blockquote><p>Use <a href="http://www.cplusplus.com/reference/unordered_map/unordered_map/">unordered_map</a> instead of ordered maps as used above (ie just <code>map</code> was used above) to make it <strong><em>really</em></strong> O(1). To read difference: <a href="http://www.geeksforgeeks.org/unordered_map-in-stl-and-its-applications/">unordered_map and map</a>.</p>

<p>The LRU Cache problem is available on Leetcode at: <a href="https://leetcode.com/problems/lru-cache/">LRU Cache</a>
if you want to check it out.</p></blockquote>

<p>Any feedback, doubts or questions, please leave in the comments.</p>
</div>


      <footer class="post-footer">
        <p class="meta text-muted">
          
  



<figure class="author-image">
    <span class="img" href="/about" style="background-image: url(/images/avatar.jpg)"><span class="hidden">Picture</span></span>
</figure>

<section class="author">
    <h4><span class="byline author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="fn" itemprop="name">Bhrigu Srivastava</span></span></h4>

    <div class="author-meta">
        <span class="author-link icon-link"><i class="fa fa-link" aria-hidden="true"></i> <a href="http://bhrigu.me">http://bhrigu.me</a></span>
    </div>
</section>

<hr>

<section class="share">
    
    <h4>Share this post</h4>
    
    <a class="fa fa-twitter" href="https://twitter.com/intent/tweet?url=http://bhrigu.me/blog/2017/01/22/lru-cache-c-plus-plus-implementation/;" 
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="fa fa-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://bhrigu.me/blog/2017/01/22/lru-cache-c-plus-plus-implementation/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="fa fa-google-plus" href="https://plus.google.com/share?url=http://bhrigu.me/blog/2017/01/22/lru-cache-c-plus-plus-implementation/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
    
</section>




<!--
<footer class="post-footer">


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=Instant%20Movie%20Streamer%20v3%20Release&amp;url=http://iyask.me/instant-movie-streamer-v3-release/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://iyask.me/instant-movie-streamer-v3-release/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://iyask.me/instant-movie-streamer-v3-release/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>


        </footer>


-->
          












  

<span class="glyphicon glyphicon-calendar"></span> <time datetime="2017-01-22T23:50:26+05:30" class="updated" itemprop="dateModified">Updated Sun 22 Jan 2017, 11:50 PM</time>
          <br>

<span class="glyphicon glyphicon-tags"></span>&nbsp;
<span class="categories">
  
    <a class='category' href='/blog/categories/c-plus-plus/'>c++</a>, <a class='category' href='/blog/categories/code/'>code</a>
  
</span>


        </p>
        
          <div class="pager">
            
            
              
                <a href="/blog/2017/01/17/huffman-coding-python-implementation/" class="col-xs-12 col-md-4 btn btn-default" title="Previous Post: Huffman Coding - Python Implementation"> 
                  <div class="text-muted">
                    <small>Previous Post</small>
                  </div>
                  <div class="pager-title">
                    <h4>Huffman Coding - Python Implementation</h4>
                  </div>
                </a>
              
            
            
            
              
              <a href="/blog/2017/02/05/my-own-octopress-theme-and-other-blog-updates/" class="col-xs-12 col-md-4 btn btn-default pull-right" title="Next Post: My own octopress theme and other blog updates">
                <div class="text-muted">
                  <small>Next Post</small>
                </div>
                <div class="pager-title">
                  <h4>My own octopress theme and other blog updates</h4>
                </div>
              </a>
              
            
            
          </div>
        
      </footer>
    </article>
    
      <section>
        <h2>Comments</h2>
        <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
      </section>
    
  </div>
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2020 - Bhrigu Srivastava<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/bhrigu123/abacus">abacus theme</a></span>.
  </small>
</p>

</div>
</footer>
    

<script type="text/javascript">
      var disqus_shortname = 'bhrigu';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://bhrigu.me/blog/2017/01/22/lru-cache-c-plus-plus-implementation/';
        var disqus_url = 'http://bhrigu.me/blog/2017/01/22/lru-cache-c-plus-plus-implementation/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>






<script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr.js"></script>


  </body>
</html>
